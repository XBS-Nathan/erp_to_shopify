parameters:
    erp.guzzle.client.config:
        base_url: %erp_base_url%
    erp.shopify.client.config:
        base_url: %shopify_base_url%
        token: %shopify_token%

services:
    erp.product_consumer:
        class: ERPBundle\Consumer\ProductConsumer
        arguments:
            - @erp.client.erp
            - @erp.services.productCatalog
            - @erp.shopify.api.client

    erp.client.erp:
        class: ERPBundle\Services\Client\ErpClient
        arguments:
            - @erp.guzzle.client.erp

    erp.client.shopifyWrapper:
        class: ERPBundle\Services\Client\ShopifyApiClientWrapper
        arguments:
            - @erp.shopify.api.client

    erp.services.productCatalog:
        class: ERPBundle\Services\ProductCatalogService
        arguments:
            - @erp.client.shopifyWrapper
            - @erp.options.shopify
            - @erp.repository.skuToProduct

    erp.guzzle.client.erp:
        class: GuzzleHttp\Client
        arguments: [%erp.guzzle.client.config%]

    erp.shopify.api.client:
        class: Shopify\Client
        factory: ["ERPBundle\Factory\Client\ShopifyApiClientFactory", "createClient"]
        arguments:
          - @erp.options.shopify

    erp.options.shopify:
        class: ERPBundle\Options\ShopifyOptions
        arguments: [%erp.shopify.client.config%]

    erp.repository.skuToProduct:
          class: Doctrine\ORM\EntityRepository
          factory_service: doctrine.orm.default_entity_manager
          factory_method: getRepository
          arguments:
              - ERPBundle\Entity\SkuToProductEntity