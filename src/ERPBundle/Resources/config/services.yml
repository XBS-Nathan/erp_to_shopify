parameters:
    erp.guzzle.client.config:
        base_url: %erp_base_url%
        defaults:
            auth: [%erp_base_username%, %erp_base_password%]
    erp.shopify.client.config:
        base_url: %shopify_base_url%
        token: %shopify_token%

services:

    erp.command.updateCatalog:
        class: ERPBundle\Commands\UpdateCatalog
        arguments: [@erp.services.shopifyStore, @old_sound_rabbit_mq.product_producer]
        tags:
            -  { name: console.command }

    erp.product_consumer:
        class: ERPBundle\Consumer\ProductConsumer
        arguments:
            - @erp.client.erp
            - @erp.services.productCatalog
            - @erp.guzzle.client.shopify

    erp.client.erp:
        class: ERPBundle\Services\Client\ErpClient
        arguments:
            - @erp.guzzle.client.erp

    erp.client.shopifyWrapper:
        class: ERPBundle\Services\Client\ShopifyApiClientWrapper
        arguments:
            - @erp.guzzle.client.shopify

    erp.services.shopifyStore:
        class: ERPBundle\Services\ShopifyStoreService
        arguments:
            - @erp.repository.catalog
            - @erp.repository.store

    erp.services.productCatalog:
        class: ERPBundle\Services\ProductCatalogService
        arguments:
            - @erp.client.shopifyWrapper
            - @erp.options.shopify
            - @erp.repository.skuToProduct

    erp.guzzle.client.erp:
        class: GuzzleHttp\Client
        arguments: [%erp.guzzle.client.config%]

    erp.guzzle.client.shopify:
        class: Shopify\Client
        factory: ["ERPBundle\Factory\Client\ShopifyApiClientFactory", "createClient"]
        arguments:
          - @erp.options.shopify

    erp.options.shopify:
        class: ERPBundle\Options\ShopifyOptions
        arguments: [%erp.shopify.client.config%]

    erp.repository.skuToProduct:
          class: Doctrine\ORM\EntityRepository
          factory_service: doctrine.orm.default_entity_manager
          factory_method: getRepository
          arguments:
              - ERPBundle\Entity\SkuToProductEntity

    erp.repository.catalog:
        class: Doctrine\ORM\EntityRepository
        factory_service: doctrine.orm.default_entity_manager
        factory_method: getRepository
        arguments:
            - ERPBundle\Entity\CatalogEntity

    erp.repository.store:
        class: Doctrine\ORM\EntityRepository
        factory_service: doctrine.orm.default_entity_manager
        factory_method: getRepository
        arguments:
            - ERPBundle\Entity\StoreEntity